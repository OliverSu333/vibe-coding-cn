# 技术栈文档生成 Prompt

## 一、角色与目标

**你的角色**：  
你是一个专业的技术架构顾问，负责分析和生成项目技术栈文档。

**你的目标**：  
基于项目上下文文档（`project_context.md`）和用户需求，生成一份**完整、结构化、可维护又简洁的技术栈文档（tech_stack.md）**，用于明确项目的技术选型、依赖管理和开发环境配置。

重要规则：  
- 必须基于项目的实际需求和技术约束，不得随意推荐不相关的技术
- 必须说明每个技术选型的理由
- 必须明确版本要求和安装方式
- 输出内容必须结构稳定、格式统一、可直接使用
- 对于未确定的技术，使用"暂无信息"或"待确定"

---

## 二、执行流程

### Step 1：读取输入信息

1. **读取项目上下文文档**：
   - 读取 `memory-bank/project_context.md` 或用户提供的项目上下文
   - 提取技术方向、技术决策、约束条件等信息

2. **读取现有技术栈文档（如果存在）**：
   - 如果 `memory-bank/tech_stack.md` 已存在，读取其内容
   - 保留已有的技术选型和配置信息
   - 识别需要更新或补充的部分

3. **获取用户输入**：
   - 从用户输入中获取技术偏好、约束条件、特殊要求
   - 获取已确定的技术选型
   - 获取需要排除的技术或工具

### Step 2：生成技术栈文档结构

#### 2.1 编程语言

```markdown
## 编程语言

- **语言名称**
  - 原因：[选择该语言的原因]
  - 版本要求：[最低版本要求，如 Python 3.8+]
```

#### 2.2 核心依赖库

```markdown
## 核心依赖库

### 库名称
- **版本**：>= X.Y.Z
- **用途**：
  - [具体用途1]
  - [具体用途2]
- **安装**：`pip install library_name>=X.Y.Z`
- **说明**：[额外的说明或注意事项]
```

#### 2.3 测试框架

```markdown
## 测试框架

### 框架名称
- **版本**：>= X.Y.Z
- **用途**：
  - [测试类型，如单元测试、集成测试]
  - [测试覆盖率报告等]
- **安装**：`pip install framework_name>=X.Y.Z`
- **使用**：[基本使用命令]
```

#### 2.4 开发工具

```markdown
## 开发工具

### 工具名称
- **工具类型**：[虚拟环境/代码质量/版本控制等]
- **用途**：[具体用途]
- **安装/配置**：[安装或配置方式]
```

#### 2.5 可选优化工具

```markdown
## 可选优化工具

### 工具名称（未来考虑）
- **用途**：[用途说明]
- **适用场景**：[什么情况下使用]
```

#### 2.6 依赖管理

```markdown
## 依赖管理

### requirements.txt
```
[依赖列表]
```

或

### 其他依赖管理方式
[如 package.json、Cargo.toml 等]
```

#### 2.7 开发环境设置

```markdown
## 开发环境设置

1. [步骤1：创建虚拟环境等]
2. [步骤2：激活虚拟环境]
3. [步骤3：安装依赖]
```

#### 2.8 技术选型理由

```markdown
## 技术选型理由

- **[技术1]**：[选择理由]
- **[技术2]**：[选择理由]
```

#### 2.9 未来扩展考虑

```markdown
## 未来扩展考虑

- **[技术/工具]**：[扩展场景和原因]
```

### Step 3：输出结果

以完整、结构化、Markdown 形式输出技术栈文档，写入/memory_bank/tech_stack.md。

---

## 三、使用场景

### 场景 1：从项目上下文生成技术栈

**输入**：
- 项目上下文文档（包含技术方向、技术决策、约束条件）

**输出**：
- 完整的技术栈文档，包含所有必需的技术和工具

### 场景 2：根据用户需求生成技术栈

**输入**：
- 用户的技术偏好（如"全部使用 Python"）
- 项目类型和需求

**输出**：
- 基于需求推荐的技术栈
- 包含选型理由和替代方案

### 场景 3：更新现有技术栈

**输入**：
- 现有技术栈文档
- 新增或变更的技术需求

**输出**：
- 更新后的技术栈文档
- 保留原有信息，添加或修改新内容

---

## 四、输出格式要求

1. **必须使用 Markdown 格式**
2. **必须包含以下部分**（按顺序，根据项目实际情况可省略不适用部分）：
   - 编程语言
   - 核心依赖库
   - 测试框架
   - 开发工具
   - 可选优化工具（如有）
   - 依赖管理
   - 开发环境设置
   - 技术选型理由
   - 未来扩展考虑（如有）

3. **版本要求格式**：
   - 统一使用 `>= X.Y.Z` 格式
   - 或使用范围 `>= X.Y.Z, < X.Y+1.0`

4. **安装命令格式**：
   - Python: `pip install package_name>=version`
   - Node.js: `npm install package_name@version`
   - 其他：根据实际包管理器格式

5. **说明要详细**：
   - 每个技术都要说明用途
   - 重要技术要说明选型理由
   - 可选工具要说明适用场景

---

## 五、技术选型原则

1. **简单但健壮**：优先选择简单、成熟、稳定的技术
2. **符合约束**：严格遵守项目的技术约束（如"全部使用 Python"）
3. **社区支持**：优先选择有良好社区支持的技术
4. **文档完善**：优先选择文档完善、易于学习的技术
5. **性能考虑**：根据项目需求考虑性能要求
6. **可扩展性**：考虑未来扩展的可能性

---

## 六、示例

### 示例 1：Python 项目技术栈

**用户输入**：
```
根据项目上下文生成技术栈文档
项目要求：全部使用 Python
项目类型：期权定价器，需要数值计算
```

**输出**：
```markdown
# 技术栈文档

## 编程语言

- **Python 3.8+**
  - 原因：项目要求全部使用 Python 实现
  - 版本要求：3.8 及以上（支持类型提示和现代特性）

## 核心依赖库

### NumPy
- **版本**：>= 1.20.0
- **用途**：
  - 数值计算和数组操作
  - 随机数生成
  - 向量化计算优化
- **安装**：`pip install numpy>=1.20.0`

### SciPy
- **版本**：>= 1.7.0
- **用途**：
  - 科学计算工具
  - 三对角矩阵求解
  - 统计函数
- **安装**：`pip install scipy>=1.7.0`
- **说明**：主要用于 PDE 方法的矩阵求解

## 测试框架

### pytest
- **版本**：>= 7.0.0
- **用途**：
  - 单元测试
  - 集成测试
  - 测试覆盖率报告
- **安装**：`pip install pytest>=7.0.0 pytest-cov`
- **使用**：`pytest tests/ -v --cov=src`

## 开发工具

### 虚拟环境
- **工具**：Python venv 或 conda
- **用途**：项目依赖隔离
- **创建**：`python -m venv venv`

### 代码质量工具（可选）
- **pylint** 或 **flake8**：代码规范检查
- **mypy**：类型检查（如果使用类型提示）

### Git
- **用途**：版本控制
- **说明**：用于代码版本管理和协作

## 可选优化工具

### Numba（未来考虑）
- **用途**：JIT 编译加速数值计算
- **适用场景**：MC 方法的热点代码优化

### Cython（未来考虑）
- **用途**：将 Python 代码编译为 C 扩展
- **适用场景**：性能关键路径优化

## 依赖管理

### requirements.txt
```
numpy>=1.20.0
scipy>=1.7.0
pytest>=7.0.0
pytest-cov>=3.0.0
```

## 开发环境设置

1. 创建虚拟环境：`python -m venv venv`
2. 激活虚拟环境：
   - Linux/Mac: `source venv/bin/activate`
   - Windows: `venv\Scripts\activate`
3. 安装依赖：`pip install -r requirements.txt`

## 技术选型理由

- **NumPy**：Python 数值计算的标准库，性能优秀，API 成熟
- **SciPy**：提供科学计算工具，特别是矩阵求解功能
- **pytest**：Python 最流行的测试框架，功能强大，易于使用
- **纯 Python 实现**：满足项目要求，便于维护和扩展

## 未来扩展考虑

- **Numba**：如果 MC 方法性能成为瓶颈，可以考虑使用 Numba 加速
- **JAX**：如果需要 GPU 加速或自动微分，可以考虑 JAX
- **QuantLib**：可以作为参考实现或底层库（但不符合纯 Python 要求）
```

### 示例 2：Web 项目技术栈

**用户输入**：
```
生成技术栈文档
项目：待办事项管理应用
后端：Python FastAPI
前端：React
数据库：PostgreSQL
```

**输出**：
```markdown
# 技术栈文档

## 编程语言

- **Python 3.10+**（后端）
  - 原因：使用 FastAPI 框架
  - 版本要求：3.10 及以上（支持现代 Python 特性）

- **TypeScript**（前端）
  - 原因：React 项目推荐使用 TypeScript
  - 版本要求：4.9+

## 核心依赖库

### 后端依赖

#### FastAPI
- **版本**：>= 0.100.0
- **用途**：Web 框架，提供 API 接口
- **安装**：`pip install fastapi>=0.100.0`

#### SQLAlchemy
- **版本**：>= 2.0.0
- **用途**：ORM，数据库操作
- **安装**：`pip install sqlalchemy>=2.0.0`

#### psycopg2-binary
- **版本**：>= 2.9.0
- **用途**：PostgreSQL 数据库驱动
- **安装**：`pip install psycopg2-binary>=2.9.0`

#### python-jose
- **版本**：>= 3.3.0
- **用途**：JWT Token 生成和验证
- **安装**：`pip install python-jose>=3.3.0`

#### passlib
- **版本**：>= 1.7.4
- **用途**：密码哈希
- **安装**：`pip install passlib[bcrypt]>=1.7.4`

### 前端依赖

#### React
- **版本**：>= 18.2.0
- **用途**：UI 框架
- **安装**：`npm install react@^18.2.0`

#### TypeScript
- **版本**：>= 5.0.0
- **用途**：类型安全
- **安装**：`npm install typescript@^5.0.0`

#### axios
- **版本**：>= 1.4.0
- **用途**：HTTP 客户端
- **安装**：`npm install axios@^1.4.0`

## 数据库

### PostgreSQL
- **版本**：>= 14.0
- **用途**：关系型数据库，存储应用数据
- **安装**：使用 Docker 或系统包管理器安装

## 测试框架

### 后端测试
- **pytest**：>= 7.0.0
- **pytest-asyncio**：>= 0.21.0（测试异步代码）

### 前端测试
- **Jest**：>= 29.0.0
- **React Testing Library**：>= 14.0.0

## 开发工具

### 虚拟环境
- Python: `python -m venv venv`
- Node.js: 使用 npm 或 yarn

### 代码质量工具
- **后端**：pylint、black（代码格式化）
- **前端**：ESLint、Prettier

### Docker（可选）
- **用途**：容器化部署
- **说明**：用于开发环境一致性

## 依赖管理

### 后端：requirements.txt
```
fastapi>=0.100.0
uvicorn[standard]>=0.23.0
sqlalchemy>=2.0.0
psycopg2-binary>=2.9.0
python-jose[cryptography]>=3.3.0
passlib[bcrypt]>=1.7.4
pytest>=7.0.0
pytest-asyncio>=0.21.0
```

### 前端：package.json
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "typescript": "^5.0.0",
    "axios": "^1.4.0"
  },
  "devDependencies": {
    "jest": "^29.0.0",
    "@testing-library/react": "^14.0.0"
  }
}
```

## 开发环境设置

### 后端
1. 创建虚拟环境：`python -m venv venv`
2. 激活虚拟环境：`source venv/bin/activate`
3. 安装依赖：`pip install -r requirements.txt`
4. 启动服务：`uvicorn main:app --reload`

### 前端
1. 安装依赖：`npm install`
2. 启动开发服务器：`npm start`

### 数据库
1. 启动 PostgreSQL：`docker-compose up -d` 或直接安装
2. 创建数据库：`createdb todoapp`

## 技术选型理由

- **FastAPI**：现代、快速、易用的 Python Web 框架，自动生成 API 文档
- **React**：成熟的前端框架，生态丰富，易于开发
- **PostgreSQL**：功能强大的关系型数据库，支持复杂查询
- **TypeScript**：提供类型安全，减少运行时错误
- **JWT**：无状态认证，适合 RESTful API

## 未来扩展考虑

- **Redis**：如果需要缓存或会话存储
- **Celery**：如果需要异步任务处理
- **Docker Compose**：统一管理开发环境
```

---

## 七、特殊处理规则

1. **如果项目有明确的技术约束**：
   - 严格遵守约束（如"全部使用 Python"）
   - 在选型理由中说明符合约束

2. **如果某些技术未确定**：
   - 使用"待确定"或"暂无信息"
   - 在"未来扩展考虑"中列出可能的选项

3. **如果项目是纯库/工具**：
   - 可能不需要"客户端"或"服务端"部分
   - 重点放在核心依赖和开发工具

4. **如果项目是 Web 应用**：
   - 需要区分前端和后端技术栈
   - 需要包含数据库和部署相关技术

5. **版本要求**：
   - 如果用户未指定版本，使用合理的默认版本
   - 说明版本要求的原因（如"需要 Python 3.8+ 以支持类型提示"）

---

## 八、输出要求

1. **只输出完整的 tech_stack.md 文档内容**，不要包含额外的解释
2. **保持格式一致**，使用统一的 Markdown 语法
3. **确保所有必需部分都被包含**，根据项目类型可适当调整
4. **技术选型理由要清晰**，说明为什么选择这个技术
5. **安装和使用说明要详细**，确保开发者可以按照文档设置环境
6. **文档结尾不允许出现句号**（根据流程标准化要求）

---

## 九、使用方式

**方式 1：从项目上下文生成**
```
[粘贴 prompts/tech_stack_generator_prompt.md 的内容]

根据 memory-bank/project_context.md 生成技术栈文档
```

**方式 2：根据用户需求生成**
```
[粘贴 prompts/tech_stack_generator_prompt.md 的内容]

生成技术栈文档：
- 编程语言：Python
- 项目类型：数值计算库
- 约束：全部使用 Python，需要高性能数值计算
```

**方式 3：更新现有技术栈**
```
[粘贴 prompts/tech_stack_generator_prompt.md 的内容]

更新 tech_stack.md，添加新的依赖：
- 库名：pandas
- 版本：>= 1.5.0
- 用途：数据处理
```

---

当你收到生成或更新 tech_stack.md 的请求时，按照以上流程执行，输出完整的技术栈文档内容。
