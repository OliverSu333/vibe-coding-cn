# 步骤执行 Prompt

## 使用方式

用户只需输入：**执行第 N 步**（N 为步骤编号，如 1、2、3...）

## 执行流程

当你收到"执行第 N 步"的指令时，请按以下流程执行：

### 1. 上下文准备阶段

1. **阅读 memory-bank 目录下的所有文档**：
   - `memory-bank/project-context.md` - 项目上下文和需求
   - `memory-bank/implementation-plan.md` - 实施计划（包含所有步骤的详细说明）
   - `memory-bank/progress.md` - 工作进度记录
   - `memory-bank/architecture.md` - 架构文档
   - `memory-bank/tech-stack.md` - 技术栈文档
   - `memory-bank/system_prompt.md` - 系统提示词（如存在）

2. **分析当前状态**：
   - 从 `progress.md` 中了解已完成和未完成的步骤
   - 确认第 N 步的前置步骤是否已完成
   - 如果前置步骤未完成，提醒用户并说明依赖关系

3. **理解第 N 步的具体要求**：
   - 从 `implementation-plan.md` 中找到第 N 步的详细说明
   - 理解该步骤的目标、输入、输出和验证方式
   - 确认需要创建或修改的文件

### 2. 执行阶段

1. **执行第 N 步的具体任务**：
   - 按照 `implementation-plan.md` 中第 N 步的详细说明执行
   - 创建必要的文件和代码
   - 实现所需功能
   - 遵循项目的代码规范和架构设计

2. **编写或更新测试**：
   - 根据步骤要求创建或更新测试文件
   - 确保测试覆盖主要功能
   - 测试应该可以直接运行（使用 pytest）

3. **代码质量检查**：
   - 确保代码符合项目规范（注释使用中文，函数/类名使用英文）
   - 检查数值计算的稳定性和边界条件处理
   - 确保模块化设计，避免单文件巨石代码

### 3. 等待验证阶段

1. **停止执行，等待用户验证**：
   - 完成第 N 步后，**立即停止**，不要继续执行下一步
   - 明确告知用户：**"第 N 步已完成，请运行测试验证。验证通过后请告知，我将继续更新文档。"**
   - 提供测试运行命令（如：`pytest tests/test_xxx.py -v`）

2. **用户验证测试**：
   - 用户负责运行测试并验证功能
   - 如果测试失败，用户会反馈问题，你需要修复问题后再次等待验证
   - **在用户明确告知"测试通过"之前，不要进行任何后续操作**

### 4. 文档更新阶段（仅在测试通过后执行）

当用户明确告知"测试通过"或"验证通过"后，执行以下操作：

1. **更新 progress.md**：
   - 打开 `memory-bank/progress.md`
   - 在"已完成步骤"部分添加：`- ✅ 步骤 N: [步骤名称]`
   - 在"步骤记录"部分添加详细记录：
     ```markdown
     ### 步骤 N: [步骤名称]
     - [x] 状态：已完成
     - [x] 完成时间：[当前日期时间]
     - [x] 备注：
       - [列出完成的具体工作，如创建的文件、实现的功能等]
       - [如有问题或特殊情况，在此说明]
     ```

2. **更新 architecture.md**：
   - 打开 `memory-bank/architecture.md`
   - 在"架构洞察"部分添加新内容：
     ```markdown
     ### 步骤 N 完成后的洞察
     - [记录架构设计的关键决策]
     - [说明新增文件的作用和职责]
     - [记录模块间的关系和依赖]
     - [如有设计模式的使用，说明原因]
     ```
   - 在"文件职责说明"部分添加新创建文件的说明：
     ```markdown
     #### 步骤 N 完成后的文件
     - `path/to/file.py`: [文件的作用和职责说明]
     ```
3. **保存文件**
   - 将当前项目git保存

4. **确认完成**：
   - 告知用户文档已更新
   - 提醒用户下一步是"执行第 N+1 步"（如果还有下一步）

## 注意事项

1. **严格遵循步骤顺序**：不要跳过步骤，除非用户明确要求
2. **测试优先**：每步完成后必须等待用户验证，不要自动继续
3. **文档同步**：测试通过后必须更新 progress.md 和 architecture.md
4. **代码规范**：
   - 注释使用中文
   - 函数名、类名、变量名使用英文
   - 遵循项目的模块化设计原则
5. **数值计算**：所有数值计算必须考虑稳定性和边界条件
6. **架构一致性**：新增代码必须符合现有架构设计

## 示例对话

**用户**：执行第 3 步

**AI**：
1. [阅读所有 memory-bank 文档]
2. [分析当前状态：步骤 1 和 2 已完成]
3. [执行步骤 3：实现市场数据模块]
4. [创建文件、编写代码、编写测试]
5. **"第 3 步已完成。已创建 `src/market_data/market_data.py` 和 `tests/test_market_data.py`。请运行测试验证：`pytest tests/test_market_data.py -v`。验证通过后请告知，我将更新文档。"**

**用户**：测试通过了

**AI**：
1. [更新 progress.md，记录步骤 3 的完成情况]
2. [更新 architecture.md，添加步骤 3 的架构洞察]
3. **"文档已更新。下一步可以执行第 4 步。"**

## 特殊情况处理

1. **前置步骤未完成**：
   - 如果第 N 步的前置步骤未完成，明确告知用户需要先完成哪些步骤
   - 不要强制执行，等待用户确认

2. **测试失败**：
   - 如果用户反馈测试失败，分析问题并修复
   - 修复后再次等待用户验证
   - 不要假设问题已解决

3. **步骤说明不清晰**：
   - 如果 `implementation-plan.md` 中第 N 步的说明不够清晰，基于项目上下文和架构设计进行合理推断
   - 在实现时做出合理的设计决策
   - 在 architecture.md 中记录这些决策

4. **架构变更**：
   - 如果第 N 步的实现需要调整架构，在 architecture.md 中详细说明变更原因和影响
   - 确保变更符合项目的整体设计原则
