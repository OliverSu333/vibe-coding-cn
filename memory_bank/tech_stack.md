# 技术栈文档

## 编程语言

- **Python 3.8+**
  - 原因：项目要求全部使用 Python 实现，丰富的科学计算库生态、易于开发和维护、良好的社区支持
  - 版本要求：3.8 及以上（支持类型提示 Type Hints 和现代 Python 特性）

## 核心依赖库

### NumPy
- **版本**：>= 1.20.0
- **用途**：
  - 数值计算和数组操作基础
  - 随机数生成（用于蒙特卡洛模拟）
  - 向量化计算优化
  - 数组和矩阵运算
- **安装**：`pip install numpy>=1.20.0`
- **说明**：Python 数值计算的标准库，是 PDE 和 MC 方法的基础依赖

### SciPy
- **版本**：>= 1.7.0
- **用途**：
  - 科学计算工具集
  - 稀疏矩阵求解（PDE 方法中的三对角线性方程组）
  - 数值积分和优化函数
  - 统计函数
- **安装**：`pip install scipy>=1.7.0`
- **说明**：主要用于 PDE 方法的矩阵求解，提供高效的线性代数运算

## 测试框架

### pytest
- **版本**：>= 7.0.0
- **用途**：
  - 单元测试：测试各个期权类和定价方法类
  - 集成测试：测试完整定价流程
  - 基准测试：与理论值或文献值对比验证
  - 测试覆盖率报告
- **安装**：`pip install pytest>=7.0.0 pytest-cov>=3.0.0`
- **使用**：`pytest tests/ -v --cov=src --cov-report=html`

## 开发工具

### 虚拟环境
- **工具类型**：Python 虚拟环境管理
- **用途**：项目依赖隔离，避免版本冲突
- **安装/配置**：
  - 创建：`python -m venv venv`
  - 激活（Linux/Mac）：`source venv/bin/activate`
  - 激活（Windows）：`venv\Scripts\activate`

### 代码格式化工具
- **工具名称**：black
- **工具类型**：代码格式化工具
- **用途**：自动格式化 Python 代码，确保符合 PEP 8 规范
- **版本**：>= 22.0.0
- **安装**：`pip install black>=22.0.0`
- **使用**：`black src/ tests/`

### 类型检查工具
- **工具名称**：mypy
- **工具类型**：静态类型检查工具
- **用途**：检查类型提示的正确性，增强代码可读性和安全性
- **版本**：>= 0.950
- **安装**：`pip install mypy>=0.950`
- **使用**：`mypy src/`

### 代码质量检查工具（可选）
- **工具名称**：pylint 或 flake8
- **工具类型**：代码规范检查工具
- **用途**：代码规范检查，发现潜在问题
- **安装**：`pip install pylint>=2.15.0` 或 `pip install flake8>=5.0.0`

### 版本控制
- **工具名称**：Git
- **工具类型**：版本控制系统
- **用途**：代码版本管理和协作开发
- **说明**：用于代码版本管理、分支管理和代码审查

### 文档生成工具（可选）
- **工具名称**：Sphinx 或 mkdocs
- **工具类型**：文档生成工具
- **用途**：生成 API 参考文档和使用文档
- **安装**：`pip install sphinx>=5.0.0` 或 `pip install mkdocs>=1.4.0`

## 可选优化工具

### Numba（未来考虑）
- **用途**：JIT 编译加速数值计算热点代码
- **适用场景**：MC 方法的路径模拟循环、PDE 方法的网格计算等性能关键路径
- **版本**：>= 0.56.0
- **说明**：如果性能成为瓶颈，可以使用 Numba 装饰器加速关键函数

### Cython（未来考虑）
- **用途**：将 Python 代码编译为 C 扩展，提升性能
- **适用场景**：性能关键路径优化，需要极致性能时使用
- **版本**：>= 0.29.0
- **说明**：实现复杂，适合长期性能优化场景

### joblib（未来考虑）
- **用途**：并行计算支持，用于批量计算场景
- **适用场景**：批量期权定价、参数敏感性分析等需要并行计算的场景
- **版本**：>= 1.2.0
- **说明**：如果批量计算成为性能瓶颈，可以使用 joblib 进行并行加速

### multiprocessing（Python 标准库）
- **用途**：多进程并行计算
- **适用场景**：批量计算、大规模蒙特卡洛模拟
- **说明**：Python 标准库，无需额外安装，适合简单的并行计算需求

## 依赖管理

### requirements.txt
```
numpy>=1.20.0
scipy>=1.7.0
pytest>=7.0.0
pytest-cov>=3.0.0
black>=22.0.0
mypy>=0.950
```

### requirements-dev.txt（开发依赖，可选）
```
pylint>=2.15.0
sphinx>=5.0.0
```

### requirements-opt.txt（可选优化依赖，未来考虑）
```
numba>=0.56.0
joblib>=1.2.0
```

## 开发环境设置

1. 创建 Python 虚拟环境：
   ```bash
   python -m venv venv
   ```

2. 激活虚拟环境：
   - Linux/Mac: `source venv/bin/activate`
   - Windows: `venv\Scripts\activate`

3. 升级 pip（推荐）：
   ```bash
   pip install --upgrade pip
   ```

4. 安装项目依赖：
   ```bash
   pip install -r requirements.txt
   ```

5. 安装开发依赖（可选）：
   ```bash
   pip install -r requirements-dev.txt
   ```

6. 验证安装：
   ```bash
   python -c "import numpy, scipy; print('安装成功')"
   pytest --version
   ```

## 技术选型理由

- **Python**：项目要求全部使用 Python 实现，Python 拥有丰富的科学计算库生态（NumPy、SciPy），易于开发和维护，具有良好的社区支持和文档资源，适合快速开发和迭代

- **NumPy**：Python 数值计算的标准库，提供高效的数组操作和向量化计算，是 PDE 和 MC 方法的基础，性能优秀，API 成熟稳定，社区支持广泛

- **SciPy**：提供科学计算工具集，特别是稀疏矩阵求解功能，对于 PDE 方法中的三对角线性方程组求解至关重要，与 NumPy 完美集成

- **pytest**：Python 最流行和功能强大的测试框架，支持单元测试、集成测试、参数化测试，易于使用，提供丰富的插件生态（如 pytest-cov 用于覆盖率报告）

- **black**：自动代码格式化工具，确保代码风格统一，符合 PEP 8 规范，减少代码审查中的格式争议，提高开发效率

- **mypy**：静态类型检查工具，配合 Python 类型提示使用，可以在开发阶段发现类型错误，提高代码质量和可维护性，特别适合大型项目

- **模块化设计**：采用面向对象设计模式（继承、多态），使用策略模式实现定价方法接口，便于扩展新的期权类型和定价方法，符合开闭原则

- **纯 Python 实现**：满足项目约束要求，便于维护和扩展，不依赖外部 C/C++ 库（除 NumPy/SciPy 底层），降低部署复杂度

## 未来扩展考虑

- **Numba JIT 编译**：如果 MC 方法的路径模拟或 PDE 方法的网格计算成为性能瓶颈，可以考虑使用 Numba 装饰器加速关键函数，通常可以获得数倍到数十倍的性能提升

- **GPU 加速**：如果需要处理大规模批量计算或极高精度的蒙特卡洛模拟，可以考虑使用 CuPy（NumPy 的 GPU 版本）或 Numba CUDA 进行 GPU 加速

- **并行计算**：如果批量计算场景增多，可以使用 joblib 或 multiprocessing 进行多进程并行计算，充分利用多核 CPU 资源

- **准蒙特卡洛（QMC）**：如果需要提高 MC 方法的收敛速度，可以考虑使用 SciPy 的 QMC 模块，使用低差异序列替代伪随机数，可以显著提高收敛速度

- **Cython 优化**：如果性能优化需求非常强烈，可以考虑使用 Cython 将性能关键路径编译为 C 扩展，获得接近 C 语言的性能

- **文档生成工具**：随着项目发展，可以使用 Sphinx 或 mkdocs 生成完整的 API 文档，提高项目的专业性和易用性

- **持续集成（CI）**：未来可以考虑集成 GitHub Actions 或 GitLab CI，自动化运行测试、代码质量检查和文档生成
